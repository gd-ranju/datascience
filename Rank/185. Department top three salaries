WITH employee_department AS (
    -- Assign rank to employees within each department based on their salary
    SELECT 
        d.id, 
        d.name AS Department, 
        e.salary AS Salary, 
        e.name AS Employee, 
        -- Rank employees by salary within each department (highest first)
        DENSE_RANK() OVER(PARTITION BY d.id ORDER BY e.salary DESC) AS rnk
    FROM Department d
    JOIN Employee e
    ON d.id = e.departmentId
)

-- Select top 3 highest-paid employees per department
SELECT Department, Employee, Salary
FROM employee_department
WHERE rnk <= 3;
