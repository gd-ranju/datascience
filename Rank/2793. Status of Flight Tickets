SELECT
  Passengers.passenger_id,
  -- Determine if the passenger gets a confirmed seat or is placed on the waitlist
  IF(
    RANK() OVER(
      PARTITION BY Passengers.flight_id
      ORDER BY Passengers.booking_time  -- Rank passengers based on booking time
    ) <= Flights.capacity,  -- Compare rank with flight capacity
    'Confirmed',  -- If within capacity, status is 'Confirmed'
    'Waitlist'    -- Otherwise, status is 'Waitlist'
  ) AS status
FROM Passengers
INNER JOIN Flights
  USING (flight_id)  -- Join Flights table to get the capacity for each flight
ORDER BY 1;  -- Order by passenger_id for better readability
