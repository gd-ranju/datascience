-- Create a Common Table Expression (CTE) to calculate dominance based on passes
WITH PassDominance AS (
    SELECT
        t1.team_name,
        -- Determine the half based on the time of the pass
        IF(time_stamp <= '45:00', 1, 2) AS half_number,
        -- Assign dominance: +1 if pass is within the same team, -1 if passed to the opponent
        IF(t1.team_name = t2.team_name, 1, -1) AS dominance
    FROM Passes p
    JOIN Teams t1 ON p.pass_from = t1.player_id
    JOIN Teams t2 ON p.pass_to = t2.player_id
)
-- Aggregate the dominance scores for each team per half
SELECT team_name, half_number, SUM(dominance) AS dominance
FROM PassDominance
GROUP BY team_name, half_number
ORDER BY team_name, half_number;
